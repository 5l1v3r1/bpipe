apply plugin: 'eclipse'
apply plugin: 'groovy'

VERSION="0.1.4"
STAGE="build/stage/bpipe-$VERSION"

repositories {
    flatDir(dirs: file('local-lib'))
    mavenCentral()
}

dependencies {
    groovy group: 'org.codehaus.groovy', name: 'groovy', version: '1.8.2'
    compile files(fileTree(dir:'local-lib', includes:['*.jar']))
    testCompile group: 'junit', name: 'junit', version: '4.8.2'
}

task stage(dependsOn: jar) << {
	ant.mkdir(dir: STAGE)
	ant.mkdir(dir: "$STAGE/bin")
	ant.mkdir(dir: "$STAGE/lib")
	ant.copy(todir: "$STAGE/bin") {
		ant.fileset(dir: 'bin', includes: "**")
	}
	ant.copy(todir: "$STAGE/lib") {
		ant.fileset(dir: 'local-lib', includes: "*.jar")
		ant.fileset(dir: 'build/libs', includes: "bpipe.jar")
	}
}

task dist(dependsOn: stage) << {
	ant.tar(destfile: "build/bpipe-${VERSION}.tar") {
		ant.fileset(dir: "build/stage", includes: "bpipe-${VERSION}/lib/**", excludes:"**/*.swp")
		ant.tarfileset(dir: "build/stage", filemode:"755", includes: "bpipe-${VERSION}/bin/**", excludes:"**/*.swp")
	}
    ant.gzip(destfile:"build/bpipe-${VERSION}.tar.gz", src: "build/bpipe-${VERSION}.tar")
}
